name: Testing semver-bump-action

on: push

jobs:
  test-action:
    runs-on: ubuntu-20.04
    strategy:
      fail-fast: true
      matrix: 
        include:
          - initial-tag: "v1.0.0"
            patch-result: "v1.0.1"
            minor-result: "v1.1.0"
            major-result: "v2.0.0"
            major-tag-result: "v2"
          - initial-tag: "v1"
            patch-result: "v1.0.1"
            minor-result: "v1.1.0"
            major-result: "v2.0.0"
            major-tag-result: "v2"
          - initial-tag: "notAVersion"
            patch-result: "v1.0.0"
            minor-result: "v1.0.0"
            major-result: "v1.0.0"
            major-tag-result: "v2" 
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: '0'

      - name: Run semver-bump-action - patch
        uses: ./
        id: semver-bump-action-patch
        with:
          INPUT_DRY_RUN: "true"
          INPUT_INITIAL_TAG: ${{ matrix.initial-tag }}
          INPUT_COMMIT_MESSAGE: "Testing patch version bump. #patch"

      - name: Verify Results
        run: |
          if [[ "${{ steps.semver-bump-action-patch.output.resulting-semver-tag}}" != "${{ matrix.patch-result }}" ]]; then
            echo "❌ Patch result failed for ${{ matrix.initial-tag }} as the input."
            exit 1
          fi
          echo "✅ Success for updating the patch with ${{ matrix.initial-tag }} as the input."

      - name: Run semver-bump-action - minor
        uses: ./
        id: semver-bump-action-minor
        with:
          INPUT_DRY_RUN: "true"
          INPUT_INITIAL_TAG: ${{ matrix.initial-tag }}
          INPUT_COMMIT_MESSAGE: "Testing minor version bump. #minor"

      - name: Verify Results
        run: |
          if [[ "${{ steps.semver-bump-action-minor.resulting-semver-tag}}" != "${{ matrix.minor-result }}" ]]; then
            echo "❌ minor result failed for ${{ matrix.initial-tag }} as the input."
            exit 1
          fi
          echo "✅ Success for updating the minor with ${{ matrix.initial-tag }} as the input."

      - name: Run semver-bump-action - major
        uses: ./
        id: semver-bump-action-major
        with:
          INPUT_DRY_RUN: "true"
          INPUT_INITIAL_TAG: ${{ matrix.initial-tag }}
          INPUT_COMMIT_MESSAGE: "Testing major version bump. #major"

      - name: Verify Results
        run: |
          if [[ "${{ steps.semver-bump-action-major.resulting-semver-tag}}" != "${{ matrix.major-result }}" ]]; then
            echo "❌ major result failed for ${{ matrix.initial-tag }} as the input."
            exit 1
          fi
          echo "✅ Success for updating the major with ${{ matrix.initial-tag }} as the input."
      
      - name: Run semver-bump-action - major tag only
        uses: ./
        id: semver-bump-action-major-tag
        with:
          INPUT_DRY_RUN: "true"
          INPUT_INITIAL_TAG: ${{ matrix.initial-tag }}
          INPUT_COMMIT_MESSAGE: "Testing major version bump. #major"

      - name: Verify Results
        run: |
          if [[ "${{ steps.semver-bump-action-major-tag.resulting-major-tag}}" != "${{ matrix.major-tag-result }}" ]]; then
            echo "❌ major tag result failed for ${{ matrix.initial-tag }} as the input."
            exit 1
          fi
          echo "✅ Success for updating the major tag with ${{ matrix.initial-tag }} as the input."
